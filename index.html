<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Attendance Management App</title>
  <link rel="stylesheet" href="style.css" />

  <!-- Font Awesome for icons -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
  <div id="appRoot">
    <!-- ==================================
         1) SIGNUP / OWNER SETUP WIZARD
         ================================== -->
    <div id="signupContainer" class="view">
      <h2>Sign Up &amp; Institute Setup</h2>
      <form id="signupForm">
        <!-- Step 1: Owner Account Info -->
        <div class="step" id="signupStep1">
          <p><strong>Step 1:</strong> Create Account (Owner/Admin)</p>
          <label>
            Full Name:
            <input type="text" id="ownerName" placeholder="Your name" required />
          </label>
          <label>
            Email:
            <input type="email" id="ownerEmail" placeholder="you@domain.com" required />
          </label>
          <label>
            Password:
            <input type="password" id="ownerPassword" placeholder="••••••" required />
          </label>
          <button type="button" id="toStep2">Next →</button>
        </div>

        <!-- Step 2: Institute Info -->
        <div class="step hidden" id="signupStep2">
          <p><strong>Step 2:</strong> Institute (School/College) Details</p>
          <label>
            Institute Name:
            <input type="text" id="instituteName" placeholder="e.g. ABC Public School" required />
          </label>
          <div id="branchesContainer">
            <p>Branches (e.g. Main Campus, Evening Branch):</p>
            <div class="auto-list">
              <input type="text" class="auto-input" placeholder="Branch name" required />
            </div>
          </div>
          <button type="button" id="toStep3">Next →</button>
          <button type="button" id="backToStep1">← Back</button>
        </div>

        <!-- Step 3: Classes -->
        <div class="step hidden" id="signupStep3">
          <p><strong>Step 3:</strong> Classes</p>
          <div id="classesContainer">
            <p>Define one or more Classes:</p>
            <div class="auto-list">
              <input type="text" class="auto-input" placeholder="Class name (e.g. 9th)" required />
            </div>
          </div>
          <button type="button" id="toStep4">Next →</button>
          <button type="button" id="backToStep2">← Back</button>
        </div>

        <!-- Step 4: Sections per Class -->
        <div class="step hidden" id="signupStep4">
          <p><strong>Step 4:</strong> Sections per Class</p>
          <div id="sectionsContainer">
            <!-- JS will populate one block per class -->
          </div>
          <button type="button" id="signupFinish">Finish &amp; Sign Up</button>
          <button type="button" id="backToStep3">← Back</button>
        </div>
      </form>
      <p id="signupError" class="error-text"></p>
    </div>

    <!-- ================================
         2) LOGIN SCREEN
         ================================ -->
    <div id="loginContainer" class="view hidden">
      <h2>Login</h2>
      <form id="loginForm">
        <label>
          Email:
          <input type="email" id="loginEmail" placeholder="you@domain.com" required />
        </label>
        <label>
          Password:
          <input type="password" id="loginPassword" placeholder="••••••" required />
        </label>
        <button type="submit">Log In</button>
      </form>
      <p id="loginError" class="error-text"></p>
      <p>
        Don’t have an account?
        <button id="showSignup">Sign Up</button>
      </p>
    </div>

    <!-- ===================================
         3) OWNER DASHBOARD
         =================================== -->
    <div id="ownerDashboard" class="view hidden">
      <nav>
        <span>Welcome, <strong id="ownerDisplayName"></strong></span>
        <button id="ownerLogoutBtn">Logout</button>
      </nav>
      <h2>Owner / Admin Dashboard</h2>

      <!-- Institute Info -->
      <section id="schoolInfo">
        <h3>Institute Info</h3>
        <p><strong>Name:</strong> <span id="infoInstituteName"></span></p>
        <p><strong>Branches:</strong> <span id="infoBranches"></span></p>
        <p><strong>Classes &amp; Sections:</strong></p>
        <ul id="infoClassesSections"></ul>
      </section>

      <!-- Add Teacher Section -->
      <section id="addTeacherSection">
        <h3>Add New Teacher</h3>
        <form id="addTeacherForm">
          <label>
            Teacher Name:
            <input type="text" id="teacherName" placeholder="e.g. Mr. Ali" required />
          </label>
          <label>
            Teacher Email:
            <input type="email" id="teacherEmail" placeholder="teacher@domain.com" required />
          </label>
          <label>
            Teacher Password:
            <input type="password" id="teacherPassword" placeholder="••••••" required />
          </label>
          <div id="assignmentsContainer">
            <p>Assign Teacher to (Class, Section):</p>
            <div class="assignment-row">
              <select class="class-select"></select>
              <select class="section-select"></select>
              <button type="button" class="removeAssignment">
                <i class="fas fa-trash"></i>
              </button>
            </div>
            <button type="button" id="addAssignmentRow">+ Add Another Assignment</button>
          </div>
          <button type="submit">Create Teacher Account</button>
        </form>
        <p id="addTeacherError" class="error-text"></p>
      </section>

      <!-- List of Teachers -->
      <section id="teacherListSection">
        <h3>Existing Teachers</h3>
        <table id="teacherTable">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Assigned Classes/Sections</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Populated by JS -->
          </tbody>
        </table>
      </section>

      <!-- Overview Counters -->
      <section id="ownerCounters">
        <h3>Overview Counters</h3>
        <div class="counters-row">
          <div class="counter-card" id="card-branches">
            <p>Branches</p>
            <p><span id="ownerBranchCount">0</span></p>
          </div>
          <div class="counter-card" id="card-classes">
            <p>Classes</p>
            <p><span id="ownerClassCount">0</span></p>
          </div>
          <div class="counter-card" id="card-teachers">
            <p>Teachers</p>
            <p><span id="ownerTeacherCount">0</span></p>
          </div>
          <div class="counter-card" id="card-students">
            <p>Students</p>
            <p><span id="ownerStudentCount">0</span></p>
          </div>
        </div>
      </section>
    </div>

    <!-- ===================================
         4) TEACHER DASHBOARD
         =================================== -->
    <div id="teacherDashboard" class="view hidden">
      <nav>
        <span>Welcome, <strong id="teacherDisplayName"></strong></span>
        <button id="teacherLogoutBtn">Logout</button>
      </nav>
      <h2>Teacher Dashboard</h2>
      <p><strong>Assigned to:</strong> <span id="teacherAssignmentsDisplay"></span></p>

      <!-- Teacher Counters -->
      <section id="teacherCounters">
        <h3>My Overview</h3>
        <div class="counters-row">
          <div class="counter-card" id="card-teacher-students">
            <p>Students</p>
            <p><span id="teacherStudentCount">0</span></p>
          </div>
          <div class="counter-card" id="card-attendance-records">
            <p>Attendance Records</p>
            <p><span id="teacherAttendanceCount">0</span></p>
          </div>
          <div class="counter-card" id="card-fines-outstanding">
            <p>Fines Outstanding</p>
            <p><span id="teacherOutstandingCount">0</span></p>
          </div>
        </div>
      </section>

      <!-- Student Registration Section -->
      <section id="studentRegistrationSection">
        <h3>Student Registration</h3>
        <form id="studentRegForm">
          <div class="row-inline">
            <label>
              Name:
              <input type="text" id="stuName" placeholder="Student name" required />
            </label>
            <label>
              Admission No:
              <input type="text" id="stuAdm" placeholder="e.g. 0001" required />
            </label>
            <label>
              Parent Name:
              <input type="text" id="stuParent" placeholder="Parent name" required />
            </label>
            <label>
              Contact:
              <input type="tel" id="stuContact" placeholder="0300xxxxxxx" required />
            </label>
            <label>
              Address:
              <input type="text" id="stuAddress" placeholder="City" required />
            </label>
            <button type="submit">Add Student</button>
          </div>
        </form>
        <table id="studentTable">
          <thead>
            <tr>
              <th>Adm#</th>
              <th>Name</th>
              <th>Parent</th>
              <th>Contact</th>
              <th>Address</th>
              <th>Fine (PKR)</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Populated by JS -->
          </tbody>
        </table>
      </section>

      <!-- Attendance Section -->
      <section id="attendanceSection">
        <h3>Mark Attendance</h3>
        <label>
          Date:
          <input type="date" id="attendanceDate" required />
        </label>
        <button id="loadAttendance">Load Students</button>
        <div id="attendanceList" class="hidden">
          <!-- JS will generate rows of buttons per student -->
        </div>
        <button id="saveAttendance" class="hidden">Save Attendance</button>
      </section>
    </div>
  </div>

  <!-- ================================
       5) LOAD AUTH & APP SCRIPTS
       ================================ -->
  <!-- Load auth.js first (handles Firebase init, signup, login, onAuthStateChanged) -->
  <script type="module" src="auth.js"></script>
  <!-- Then load app.js (core functionality, relies on auth.js exports) -->
  <script type="module" src="app.js"></script>
</body>
</html>
