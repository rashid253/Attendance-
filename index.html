<!-- index.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Attendance Management</title>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>

  <!-- idb-keyval -->
  <script src="https://cdn.jsdelivr.net/npm/idb-keyval@3/dist/idb-keyval-iife.min.js"></script>
  <!-- jsPDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="style.css"/>

  <style>
    @media print { .no-print { display: none !important; } }
    .hidden { display: none; }
    .card { border:1px solid #ccc; padding:1em; margin-top:1em; border-radius:4px;}
    .row-inline > * { margin-right:.5em; margin-bottom:.5em; }
    .modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); display:flex; align-items:center; justify-content:center; }
    .modal-content { background:#fff; padding:1.5em; border-radius:6px; width:90%; max-width:400px; position:relative; }
    .modal-close { position:absolute; top:8px; right:12px; cursor:pointer; }
  </style>
</head>
<body>
  <header><h1><i class="fas fa-school"></i> Attendance Management</h1></header>

  <!-- 1. SETUP -->
  <section id="teacher-setup">
    <h2><i class="fas fa-cog"></i> Setup</h2>
    <div id="setupForm" class="row-inline">
      <input id="schoolNameInput" placeholder="School Name" />
      <select id="teacherClassSelect">
        <option disabled selected>-- Select Class --</option>
      </select>
      <select id="teacherSectionSelect">
        <option disabled selected>-- Select Section --</option>
      </select>
      <button id="saveSetup" class="no-print"><i class="fas fa-save"></i> Save</button>
    </div>
    <div id="setupDisplay" class="hidden">
      <h3><i class="fas fa-school"></i> <span id="setupText"></span></h3>
      <button id="editSetup" class="no-print"><i class="fas fa-edit"></i> Edit</button>
    </div>
  </section>

  <!-- 2. FINANCIAL SETTINGS -->
  <section id="financial-settings">
    <h2><i class="fas fa-wallet"></i> Fines & Eligibility</h2>
    <div id="financialForm" class="row-inline">
      <label>Fine/Absent:<input id="fineAbsent" type="number"/></label>
      <label>Fine/Late:<input id="fineLate" type="number"/></label>
      <label>Fine/Leave:<input id="fineLeave" type="number"/></label>
      <label>Fine/Half-Day:<input id="fineHalfDay" type="number"/></label>
      <label>Eligibility %:<input id="eligibilityPct" type="number" min="0" max="100"/></label>
      <label><input type="radio" name="fineMode" value="advance"> Advance Mode</label>
      <label><input type="radio" name="fineMode" value="prorata"> Pro-Rata Mode</label>
      <label><button id="addHolidayDate" class="no-print"><i class="fas fa-calendar-day"></i> Add Holiday Date</button></label>
      <label><button id="addHolidayMonth" class="no-print"><i class="fas fa-calendar-alt"></i> Add Holiday Month</button></label>
      <button id="saveSettings" class="no-print"><i class="fas fa-save"></i> Save</button>
    </div>
    <div id="settingsCard" class="card hidden"></div>
    <button id="editSettings" class="btn no-print hidden"><i class="fas fa-edit"></i> Edit Settings</button>
  </section>

  <!-- containers for dynamic holiday pickers -->
  <div id="holidayPickers" class="row-inline hidden"></div>

  <!-- 3. COUNTERS -->
  <section id="counters" class="row-inline">
    <div>Section: <span id="sectionCount">0</span></div>
    <div>Class: <span id="classCount">0</span></div>
    <div>School: <span id="schoolCount">0</span></div>
  </section>

  <!-- 4. STUDENT REGISTRATION -->
  <section id="student-registration">
    <h2><i class="fas fa-user-graduate"></i> Student Registration</h2>
    <div class="row-inline">
      <input id="studentName" placeholder="Name"/>
      <input id="parentName" placeholder="Parent"/>
      <input id="parentContact" placeholder="Contact"/>
      <input id="parentOccupation" placeholder="Occupation"/>
      <input id="parentAddress" placeholder="Address"/>
      <button id="addRegistration" class="no-print"><i class="fas fa-plus"></i> Add</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>#</th><th>Name</th><th>Adm#</th><th>Parent</th><th>Contact</th>
          <th>Occ</th><th>Addr</th><th>P</th><th>Lt</th><th>L</th><th>HD</th><th>A</th><th>Total</th><th>%</th><th>Fine</th><th>Status</th><th>Pay</th>
        </tr>
      </thead>
      <tbody id="studentsBody"></tbody>
    </table>
  </section>

  <!-- 5. ATTENDANCE -->
  <section id="attendance-section">
    <h2><i class="fas fa-calendar-check"></i> Mark Attendance</h2>
    <div class="row-inline">
      <input type="date" id="attendanceDate"/>
      <button id="loadAttendance" class="no-print"><i class="fas fa-sync"></i> Load</button>
      <button id="saveAttendance" class="no-print hidden"><i class="fas fa-save"></i> Save</button>
    </div>
    <div id="attendanceBody" class="row-inline"></div>
  </section>

  <!-- 6. ANALYTICS -->
  <section id="analytics-section">
    <h2><i class="fas fa-chart-bar"></i> Analytics</h2>
    <div class="row-inline">
      <input type="date" id="analyticsFrom"/>
      <input type="date" id="analyticsTo"/>
      <button id="loadAnalytics" class="no-print"><i class="fas fa-chart-bar"></i> Load</button>
    </div>
    <div id="instructions"></div>
    <table id="analyticsTable">
      <thead><tr></tr></thead>
      <tbody id="analyticsBody"></tbody>
    </table>
    <canvas id="barChart"></canvas>
    <canvas id="pieChart"></canvas>
  </section>

  <!-- 7. REGISTER -->
  <section id="register-section">
    <h2><i class="fas fa-book-open"></i> Attendance Register</h2>
    <div class="row-inline">
      <input type="month" id="registerMonth"/>
      <button id="loadRegister" class="no-print"><i class="fas fa-calendar"></i> Load</button>
    </div>
    <div id="registerTableWrapper" class="hidden">
      <table id="registerTable">
        <thead><tr id="registerHeader"></tr></thead>
        <tbody id="registerBody"></tbody>
      </table>
    </div>
  </section>

  <!-- PAYMENT MODAL -->
  <div id="paymentModal" class="modal hidden">
    <div class="modal-content">
      <span id="closePayment" class="modal-close">&times;</span>
      <h3>Payment for <span id="paymentAdm"></span></h3>
      <input id="paymentAmount" type="number" placeholder="Amount"/>
      <input id="paymentDate" type="date"/>
      <button id="savePayment" class="no-print"><i class="fas fa-check"></i> Save</button>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
