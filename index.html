<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Classwise Attendance Management</title>

  <!-- PWA manifest -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#2196F3" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="Attendance Mgmt" />

  <!-- Google Font: Roboto -->
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet" />

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="style.css" />

  <!-- small inline tweaks for attendance buttons -->
  <style>
    .attendance-actions { display: flex; gap: 0.25em; }
    .attendance-actions button { flex: 1; padding: 0.5em; font-size: 1rem; min-width: 0; }
  </style>

  <!-- Load idb-keyval -->
  <script type="module">
    import * as idbKeyvalModule from 'https://cdn.jsdelivr.net/npm/idb-keyval@6/+esm';
    window.idbKeyval = idbKeyvalModule;
  </script>
</head>
<body class="bg-light" style="font-family:'Roboto',sans-serif;">
  <!-- Header -->
  <header class="text-center py-4 bg-primary text-white">
    <h1 class="mb-0"><i class="fas fa-school me-2"></i>Attendance Management</h1>
  </header>

  <!-- Dashboard Cards -->
  <section id="dashboard" class="container my-4">
    <div class="row g-3 justify-content-center">
      <div class="col-6 col-md-4">
        <div class="card text-center shadow-sm">
          <div class="card-body">
            <i class="fas fa-users fa-2x text-secondary"></i>
            <h5 class="card-title mt-2" id="totalSchoolCount">0<br/><small>Students</small></h5>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4">
        <div class="card text-center shadow-sm">
          <div class="card-body">
            <i class="fas fa-chalkboard-teacher fa-2x text-secondary"></i>
            <h5 class="card-title mt-2" id="totalClassCount">0<br/><small>Class</small></h5>
          </div>
        </div>
      </div>
      <div class="col-6 col-md-4">
        <div class="card text-center shadow-sm">
          <div class="card-body">
            <i class="fas fa-layer-group fa-2x text-secondary"></i>
            <h5 class="card-title mt-2" id="totalSectionCount">0<br/><small>Section</small></h5>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="container">
    <!-- 1. Setup -->
    <section id="teacher-setup" class="mb-4">
      <h2><i class="fas fa-cog me-2"></i>Setup</h2>
      <div id="setupForm" class="row row-cols-auto g-2 align-items-center">
        <input id="schoolNameInput" class="form-control" placeholder="School Name" />
        <select id="teacherClassSelect" class="form-select">
          <option value="">--Class--</option>
          <!-- options... -->
        </select>
        <select id="teacherSectionSelect" class="form-select">
          <option value="">--Section--</option><option>A</option><option>B</option><option>C</option>
        </select>
        <button type="button" id="saveSetup" class="btn btn-success">
          <i class="fas fa-save me-1"></i>Save
        </button>
      </div>
      <div id="setupDisplay" class="hidden mt-2">
        <h3 id="setupText"></h3>
        <button type="button" id="editSetup" class="btn btn-info btn-sm">
          <i class="fas fa-edit me-1"></i>Edit
        </button>
      </div>
    </section>

    <!-- 2. Student Registration -->
    <section id="student-registration" class="mb-4">
      <h2><i class="fas fa-user-graduate me-2"></i>Student Registration</h2>
      <div id="regForm" class="row row-cols-auto g-2 align-items-center">
        <input id="studentName" class="form-control" placeholder="Name" />
        <input id="admissionNo" class="form-control" placeholder="Adm#" />
        <input id="parentName" class="form-control" placeholder="Parent Name" />
        <input id="parentContact" class="form-control" placeholder="Parent Contact" />
        <input id="parentOccupation" class="form-control" placeholder="Occupation" />
        <input id="parentAddress" class="form-control" placeholder="Address" />
        <button type="button" id="addStudent" class="btn btn-primary">
          <i class="fas fa-plus-circle me-1"></i>Add
        </button>
      </div>
      <div class="table-wrapper" id="studentTableWrapper">
        <table id="studentTable" class="table table-striped">
          <thead><tr>
            <th><input type="checkbox" id="selectAllStudents" /></th>
            <th>Sr#</th><th>Name</th><th>Adm#</th><th>Parent</th><th>Contact</th><th>Occupation</th><th>Address</th><th>Share</th>
          </tr></thead>
          <tbody id="studentsBody"></tbody>
        </table>
      </div>
      <div class="table-actions mt-2">
        <button id="editSelected" class="btn btn-warning" disabled><i class="fas fa-edit me-1"></i>Edit Selected</button>
        <button id="deleteSelected" class="btn btn-danger" disabled><i class="fas fa-trash-alt me-1"></i>Delete Selected</button>
        <button id="saveRegistration" class="btn btn-success"><i class="fas fa-save me-1"></i>Save Table</button>
        <button id="shareRegistration" class="btn btn-primary hidden"><i class="fas fa-share-alt me-1"></i>Share Table</button>
        <button id="editRegistration" class="btn btn-warning btn-sm hidden"><i class="fas fa-edit me-1"></i>Edit Table</button>
        <button id="downloadRegistrationPDF" class="btn btn-danger hidden"><i class="fas fa-file-pdf me-1"></i>Download PDF</button>
      </div>
    </section>

    <!-- 3. Attendance Marking -->
    <section id="attendance-section" class="mb-4">
      <h2><i class="fas fa-calendar-check me-2"></i>Mark Attendance</h2>
      <div class="row row-cols-auto g-2 align-items-center mb-2">
        <label for="dateInput" class="col-form-label">Select Date:</label>
        <input type="date" id="dateInput" class="form-control" />
        <button id="loadAttendance" class="btn btn-primary"><i class="fas fa-sync-alt me-1"></i>Load Attendance</button>
      </div>
      <div id="attendanceList"></div>
      <button id="saveAttendance" class="btn btn-success hidden"><i class="fas fa-save me-1"></i>Save</button>
    </section>

    <!-- 4. Attendance Summary -->
    <section id="attendance-result" class="hidden mb-4">
      <h2><i class="fas fa-clipboard-list me-2"></i>Attendance Summary</h2>
      <div class="table-wrapper">
        <table class="table"><thead><tr><th>Name</th><th>Status</th><th>Send</th></tr></thead>
        <tbody id="summaryBody"></tbody></table>
      </div>
      <div class="table-actions mt-2">
        <button id="shareAttendanceSummary" class="btn btn-primary"><i class="fas fa-share-alt me-1"></i>Share Table</button>
        <button id="downloadAttendancePDF" class="btn btn-danger"><i class="fas fa-file-pdf me-1"></i>Download PDF</button>
        <button id="resetAttendance" class="btn btn-info btn-sm"><i class="fas fa-undo me-1"></i>Reset</button>
      </div>
    </section>

    <!-- 5. Analytics -->
    <section id="analytics-section" class="mb-4">
      <h2><i class="fas fa-chart-bar me-2"></i>Analytics</h2>
      <div class="row row-cols-auto g-2 align-items-center mb-2">
        <label for="analyticsTarget" class="col-form-label">Report For:</label>
        <select id="analyticsTarget" class="form-select"><option value="class">Full Class</option><option value="student">Individual Student</option></select>
        <input id="studentAdmInput" class="form-control hidden" placeholder="Admission #" />
        <label for="analyticsType" class="col-form-label">Period:</label>
        <select id="analyticsType" class="form-select">
          <option value="" disabled selected>--Select Period--</option>
          <option value="date">Specific Date</option>
          <option value="month">Month</option>
          <option value="semester">Semester</option>
          <option value="year">Year</option>
        </select>
        <input type="date" id="analyticsDate" class="form-control hidden" />
        <input type="month" id="analyticsMonth" class="form-control hidden" />
        <input type="month" id="semesterStart" class="form-control hidden" />
        <input type="month" id="semesterEnd" class="form-control hidden" />
        <input type="number" id="yearStart" class="form-control hidden" placeholder="Year" />
        <button id="loadAnalytics" class="btn btn-primary"><i class="fas fa-sync-alt me-1"></i>Load Analytics</button>
        <button id="resetAnalytics" class="btn btn-info btn-sm hidden"><i class="fas fa-undo me-1"></i>Change</button>
      </div>
      <div id="instructions" class="summary-block hidden"></div>
      <div id="analyticsContainer" class="table-container hidden"></div>
      <div id="graphs" class="graph-container hidden">
        <canvas id="barChart"></canvas>
        <canvas id="pieChart"></canvas>
      </div>
      <div id="analyticsActions" class="row row-cols-auto g-2 hidden">
        <button id="shareAnalytics" class="btn btn-primary"><i class="fas fa-share-alt me-1"></i>Share as Text</button>
        <button id="downloadAnalytics" class="btn btn-danger"><i class="fas fa-file-pdf me-1"></i>Download PDF</button>
      </div>
    </section>

    <!-- 6. Attendance Register -->
    <section id="register-section" class="mb-4">
      <h2><i class="fas fa-book-open me-2"></i>Attendance Register</h2>
      <div class="row row-cols-auto g-2 align-items-center mb-2">
        <label for="registerMonth" class="col-form-label">Select Month:</label>
        <input type="month" id="registerMonth" class="form-control" />
        <button id="loadRegister" class="btn btn-success"><i class="fas fa-sync-alt me-1"></i>Load Register</button>
        <button id="changeRegister" class="btn btn-info btn-sm hidden"><i class="fas fa-undo me-1"></i>Change Period</button>
      </div>
      <div class="table-wrapper hidden" id="registerTableWrapper">
        <table id="registerTable" class="table table-striped">
          <thead><tr><th>Sr#</th><th>Adm#</th><th>Name</th></tr></thead>
          <tbody id="registerBody"></tbody>
        </table>
      </div>
      <div id="registerSummarySection" class="hidden">
        <h3>Summary</h3>
        <div class="table-wrapper">
          <table class="table"><thead><tr><th>Name</th><th>P</th><th>A</th><th>Lt</th><th>HD</th><th>L</th><th>%</th></tr></thead>
            <tbody id="registerSummaryBody"></tbody></table>
        </div>
      </div>
      <div class="table-actions mt-2">
        <button id="shareRegister" class="btn btn-primary"><i class="fas fa-share-alt me-1"></i>Share Summary</button>
        <button id="downloadRegisterPDF" class="btn btn-danger"><i class="fas fa-file-pdf me-1"></i>Download PDF</button>
      </div>
    </section>
  </div>

  <!-- External Libraries + Main Script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script type="module" src="app.js"></script>

  <!-- Mobileâ€friendly error console -->
  <script src="//cdn.jsdelivr.net/npm/eruda"></script>
  <script>eruda.init();</script>
</body>
</html>
```

```css
/* style.css */
:root {
  --primary: #2196F3;
  --success: #4CAF50;
  --danger: #f44336;
  --warning: #FFEB3B;
  --orange: #FF9800;
  --info: #03a9f4;
  --light: #f2f2f2;
  --dark: #333;
}

/* prevent flicker */
* {
  -webkit-tap-highlight-color: transparent;
  outline: none;
}

body {
  font-family: 'Roboto', Arial, sans-serif;
  color: var(--dark);
  background: var(--light);
  padding: 10px;
}

header {
  background: var(--primary);
  color: #fff;
  padding: 15px;
  text-align: center;
  margin-bottom: 10px;
}

section {
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 6px;
  margin-bottom: 20px;
  padding: 15px;
}

.row-inline, .row-cols-auto {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
}

label {
  font-weight: bold;
}

input,
select,
button {
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  cursor: pointer;
}

/* Hide old totals bar if any */
header .totals-bar { display: none !important; }

.table-wrapper {
  overflow-x: auto;
  margin-top: 10px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.table-wrapper.saved {
  border: 2px solid var(--success);
  background: var(--light);
}

table {
  width: 100%;
  border-collapse: collapse;
}

th,
td {
  border: 1px solid #ccc;
  padding: 8px;
  white-space: nowrap;
  text-align: left;
}

th {
  background: var(--light);
}

.table-actions {
  display: flex;
  gap: 10px;
  margin-top: 10px;
  flex-wrap: wrap;
}

.attendance-item {
  font-weight: bold;
  margin-bottom: 5px;
}

.attendance-item + .attendance-actions {
  display: flex;
  gap: 5px;
  margin-bottom: 15px;
}

.graph-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  margin-top: 15px;
}

canvas {
  flex: 1 1 300px;
  max-width: 100%;
}

.selected {
  background: var(--light);
}

.editing {
  outline: 2px dashed var(--info);
}

.select-col {
  width: 40px;
}

@media (max-width: 600px) {
  .row-inline input,
  .row-inline select,
  .row-inline button,
  .row-cols-auto > * {
    flex: 1 1 100%;
  }
}
```

```javascript
// app.js (unchanged functionality)
window.addEventListener('DOMContentLoaded', async () => {
  const { get, set } = idbKeyval;
  const $ = id => document.getElementById(id);

  let students       = await get('students')       || [];
  let attendanceData = await get('attendanceData') || {};

  async function saveStudents() {
    await set('students', students);
  }
  async function saveAttendanceData() {
    await set('attendanceData', attendanceData);
  }

  function getCurrentClassSection() {
    return {
      cls: $('teacherClassSelect').value,
      sec: $('teacherSectionSelect').value
    };
  }
  function filteredStudents() {
    const { cls, sec } = getCurrentClassSection();
    return students.filter(s => s.cls === cls && s.sec === sec);
  }

  function updateTotals() {
    const totalSchool = students.length;
    const { cls, sec } = getCurrentClassSection();
    const totalClass   = students.filter(s => s.cls === cls).length;
    const totalSection = filteredStudents().length;
    $('totalSchoolCount').textContent  = totalSchool;
    $('totalClassCount').textContent   = totalClass;
    $('totalSectionCount').textContent = totalSection;
  }

  // ...remaining code unchanged...
});


